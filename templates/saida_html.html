<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="Content-Type" content="text/html;charset=UTF-8"> 
        <title>Correlação</title>
        <script src="https://canvasjs.com/assets/script/canvasjs.min.js"></script>
    </head>
    <body>
        <center>
            <h3>Resultado correlação da empresa: {{ dados['emp_princ'] }} </h3>
            <br>
            <ul>
                {% for item in dados['emp_comp'] %}
                    <li style="list-style-type: none;">{{ item }}: {{ dados['corr_geral'][item]['corr'] }}</li>
                {% endfor %}
            </ul>
            <br>
            <br>
            <div>
                {% for item in dados['corr_periodo'].keys() %}
                    <input type="hidden" value="{{ item }}" class="period_emp"/>
                    {% with data = dados['corr_periodo'][item] %}
                        {% for d in data %}
                            <input type="hidden" value="{{ d['dt_init'] }}" id="period_init_{{ item }}"/>
                            <input type="hidden" value="{{ d['dt_fim'] }}" id="period_fim_{{ item }}"/>
                            <input type="hidden" value="{{ d['corr'] }}" id="period_corr_{{ item }}"/>
                            <input type="hidden" value="{{ d['var'] }}" id="period_var_{{ item }}"/>
                        {% endfor %}
                    {% endwith %}
                {% endfor %}
                <div id="Period" style="height: 300px; width: 100%;"></div>
            </div>

            <br>
            <br>
            <div>
                {% for item in dados['corr_prog'].keys() %}
                    <input type="hidden" value="{{ item }}" class="progress_emp"/>
                    {% with data = dados['corr_prog'][item] %}
                        {% for d in data %}
                            <input type="hidden" value="{{ d['dt_init'] }}" id="progress_init_{{ item }}"/>
                            <input type="hidden" value="{{ d['dt_fim'] }}" id="progress_fim_{{ item }}"/>
                            <input type="hidden" value="{{ d['corr'] }}" id="progress_corr_{{ item }}"/>
                            <input type="hidden" value="{{ d['var'] }}" id="progress_var_{{ item }}"/>
                        {% endfor %}
                    {% endwith %}
                {% endfor %}
                <div id="Progress" style="height: 300px; width: 100%;"></div>
            </div>

        </center>
    </body>
    <script type="text/javascript">
        window.onload = function () {

            var chart = new CanvasJS.Chart("Period", {
                animationEnabled: true,
                theme: "light2",
                title:{
                    text: "Correlação por período de 90 dias."
                },
                axisX:{
                    valueFormatString: "DD MMM YYYY",
                    crosshair: {
                        enabled: true,
                        snapToDataPoint: true
                    }
                },
                axisY: {
                    title: "Grau Correlação",
                    crosshair: {
                        enabled: true
                    }
                },
                toolTip:{
                    shared:true
                },  
                legend:{
                    cursor:"pointer",
                    verticalAlign: "bottom",
                    horizontalAlign: "left",
                    dockInsidePlotArea: true,
                    itemclick: toogleDataSeries
                },
                data: [{
                    type: "line",
                    showInLegend: true,
                    name: "Total Visit",
                    markerType: "square",
                    xValueFormatString: "DD MMM YYYY",
                    color: "#F08080",
                    dataPoints: [
                        { x: new Date(2017, 0, 3), y: 650 },
                        { x: new Date(2017, 0, 4), y: 700 },
                        { x: new Date(2017, 0, 5), y: 710 },
                        { x: new Date(2017, 0, 6), y: 658 },
                        { x: new Date(2017, 0, 7), y: 734 },
                        { x: new Date(2017, 0, 8), y: 963 },
                        { x: new Date(2017, 0, 9), y: 847 },
                        { x: new Date(2017, 0, 10), y: 853 },
                        { x: new Date(2017, 0, 11), y: 869 },
                        { x: new Date(2017, 0, 12), y: 943 },
                        { x: new Date(2017, 0, 13), y: 970 },
                        { x: new Date(2017, 0, 14), y: 869 },
                        { x: new Date(2017, 0, 15), y: 890 },
                        { x: new Date(2017, 0, 16), y: 930 }
                    ]
                },
                {
                    type: "line",
                    showInLegend: true,
                    name: "Unique Visit",
                    lineDashType: "dash",
                    dataPoints: [
                        { x: new Date(2017, 0, 3), y: 510 },
                        { x: new Date(2017, 0, 4), y: 560 },
                        { x: new Date(2017, 0, 5), y: 540 },
                        { x: new Date(2017, 0, 6), y: 558 },
                        { x: new Date(2017, 0, 7), y: 544 },
                        { x: new Date(2017, 0, 8), y: 693 },
                        { x: new Date(2017, 0, 9), y: 657 },
                        { x: new Date(2017, 0, 10), y: 663 },
                        { x: new Date(2017, 0, 11), y: 639 },
                        { x: new Date(2017, 0, 12), y: 673 },
                        { x: new Date(2017, 0, 13), y: 660 },
                        { x: new Date(2017, 0, 14), y: 562 },
                        { x: new Date(2017, 0, 15), y: 643 },
                        { x: new Date(2017, 0, 16), y: 570 }
                    ]
                }]
            });
            chart.render();

            function toogleDataSeries(e){
                if (typeof(e.dataSeries.visible) === "undefined" || e.dataSeries.visible) {
                    e.dataSeries.visible = false;
                } else{
                    e.dataSeries.visible = true;
                }
                chart.render();
            }
        }

    </script>
</html>
